# 🥔 Potato Discord Bot - 多功能伺服器管理系統

一個功能完整的 Discord 多功能機器人，包含票券系統、投票系統等核心功能，並持續擴展中。

## 📋 專案狀態

### ✅ 已完成功能

#### 🎫 票券系統核心 (v1.1)
- **基本票券操作** - 建立、關閉、查詢票券 ✅
- **票券面板** - 互動式票券建立介面 ✅
- **權限系統** - 三層權限架構（用戶/客服/管理員） ✅
- **基本設定** - 分類頻道、客服角色設定 ✅
- **資料庫整合** - 完整的資料持久化 ✅
- **評分系統** - 五星評分機制 ✅
- **頻道管理** - 自動建立和管理票券頻道 ✅

#### 🎯 票券系統進階功能 (v1.2) - ✅ 已完成
- **票券指派系統** - 手動/自動指派、工作量追蹤 ✅
- **客服專精系統** - 專業領域匹配和技能等級 ✅
- **優先級管理** - 三級優先級（高/中/低）系統 ✅
- **視覺化標識** - 優先級emoji標識和自動排序 ✅
- **標籤系統** - 票券分類標籤和自動應用規則 ✅
- **標籤篩選** - 按標籤篩選票券列表 ✅
- **統計面板** - 綜合統計儀表板和實時監控 ✅
- **績效分析** - 客服工作量和效率統計 ✅
- **合作夥伴類型** - 新增商業合作專用票券類型 ✅

#### 🎉 歡迎系統 (v1.3) - ✅ 新完成
- **歡迎訊息** - 自定義加入歡迎訊息，支援變數替換 ✅
- **離開訊息** - 自定義離開訊息 ✅
- **自動身分組** - 新成員自動分配指定身分組 ✅
- **私訊歡迎** - 可選的私訊歡迎功能 ✅
- **事件日誌** - 完整的加入/離開事件記錄 ✅
- **統計監控** - 成員增減統計和趨勢分析 ✅

#### 🎛️ 系統管理面板 (v1.3) - ✅ 新完成
- **圖形化管理** - 統一的系統管理UI界面 ✅
- **票券系統設定** - 頻道、角色、參數設定 ✅
- **歡迎系統設定** - 訊息、身分組、功能開關 ✅
- **統計監控** - 即時系統狀態和使用統計 ✅
- **系統工具** - 維護工具和資料管理 ✅

#### 🗳️ 投票系統
- **投票建立** - 支援單選/多選投票
- **互動式引導** - 步驟式投票建立流程
- **權限控制** - 角色權限管理
- **匿名投票** - 支援匿名和實名投票
- **即時統計** - 動態票數統計和視覺化
- **歷史查詢** - 完整的投票歷史記錄
- **搜尋功能** - 關鍵字搜尋投票

#### 🔧 系統基礎
- **資料庫管理** - MySQL 連接池和資料管理
- **錯誤處理** - 全局錯誤處理和用戶友善提示
- **日誌系統** - 完整的操作日誌記錄
- **配置管理** - 環境變數和設定管理
- **模組化設計** - 可擴展的 Cog 架構
- **Persistent Views** - 機器人重啟後UI元件持續運作

### 🚧 開發中功能

#### 🎫 票券系統自動化功能
- **🤖 v1.3 - 自動化系統 (進行中)**
  - 自動回覆系統
  - SLA 監控和超時警告
  - 自動關閉規則
  - 批次操作工具

#### 📊 進階分析功能  
- **📈 v1.4 - 高級統計 (規劃中)**
  - PDF/Excel 報表導出
  - 趨勢預測分析
  - 客戶滿意度追蹤
  - KPI 基準測試

### 🔮 規劃中功能

#### 🎯 階段一：客服效率提升 (預計 2-3 個月)
- **回覆模板系統** - 快速回覆模板管理
- **客服專精系統** - 專業領域匹配分配
- **快捷操作面板** - 客服專用快捷工具
- **工作量平衡** - 自動工作量分配演算法

#### 📈 階段二：數據分析強化 (預計 3-4 個月)  
- **進階報表系統** - PDF/Excel 報表導出
- **趨勢分析** - 機器學習驅動的分析
- **客戶滿意度追蹤** - 長期滿意度趨勢
- **性能基準測試** - KPI 追蹤和基準比較

#### 🔗 階段三：整合與擴展 (預計 4-6 個月)
- **外部API整合** - 第三方服務整合
- **Webhook支援** - 外部系統通知
- **多語言支援** - 國際化功能
- **插件系統** - 第三方擴展支援

#### 🛡️ 階段四：企業級功能 (預計 6+ 個月)
- **備份與恢復** - 自動備份系統
- **負載均衡** - 多實例部署支援
- **安全審計** - 操作審計和合規報告
- **高可用性** - 故障轉移和災難恢復

## 🏗️ 當前系統架構

```
bot/
├── main.py                    # 主程式入口
├── cogs/                      # 功能模組
│   ├── ticket_core.py         # ✅ 票券核心功能
│   ├── ticket_listener.py     # ✅ 票券事件監聽
│   ├── vote.py               # ✅ 投票系統
│   └── vote_listener.py      # ✅ 投票事件監聽
├── db/                        # 資料庫層
│   ├── pool.py               # ✅ 連接池管理
│   ├── database_manager.py   # ✅ 資料庫管理
│   ├── ticket_dao.py         # ✅ 票券資料存取
│   ├── assignment_dao.py     # ✅ 指派系統資料存取
│   ├── tag_dao.py            # ✅ 標籤系統資料存取
│   ├── welcome_dao.py        # ✅ 歡迎系統資料存取
│   ├── vote_dao.py           # ✅ 投票資料存取
│   └── base_dao.py           # ✅ 基礎資料存取
├── views/                     # UI 組件
│   ├── ticket_views.py       # ✅ 票券UI組件
│   └── vote_views.py         # ✅ 投票UI組件
├── services/                  # 業務邏輯層
│   ├── ticket_manager.py     # ✅ 票券業務邏輯
│   ├── assignment_manager.py # ✅ 指派系統管理
│   ├── tag_manager.py        # ✅ 標籤系統管理
│   └── statistics_manager.py # ✅ 統計系統管理
├── utils/                     # 工具函數
│   ├── embed_builder.py      # ✅ 嵌入訊息建構器
│   ├── ticket_constants.py   # ✅ 票券常數定義
│   ├── ticket_utils.py       # ✅ 票券工具函數
│   ├── vote_utils.py         # ✅ 投票工具函數
│   ├── error_handler.py      # ✅ 錯誤處理器
│   └── helper.py             # ✅ 通用工具函數
└── register/                  # 註冊管理
    └── register.py           # ✅ PersistentView註冊
```

## 🚀 快速開始

### 1. 環境準備

```bash
# 安裝依賴
pip install discord.py aiomysql python-dotenv

# 設定環境變數
cp .env.example .env
```

### 2. 環境變數設定

```env
# Discord 設定
DISCORD_TOKEN=your_bot_token_here

# 資料庫設定
DB_HOST=localhost
DB_PORT=3306
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=discord_bot
```

### 3. 啟動機器人

```bash
python bot/main.py
```

## 🎮 已實裝指令清單

### 📋 票券系統指令

#### 管理指令 (需要 `manage_guild` 權限)
| 指令 | 描述 | 範例 |
|------|------|------|
| `!setup_ticket` | 建立票券面板 | `!setup_ticket` |
| `!set_ticket_category` | 設定票券分類頻道 | `!set_ticket_category #客服中心` |
| `!ticket_settings` | 查看票券系統設定 | `!ticket_settings` |
| `!ticket_test` | 測試票券系統運作 | `!ticket_test` |
| `!ticket_help` | 顯示票券指令說明 | `!ticket_help` |

#### 🎯 指派管理指令 (客服/管理員)
| 指令 | 描述 | 範例 |
|------|------|------|
| `!assign_ticket` | 手動指派票券 | `!assign_ticket 123 @客服員` |
| `!auto_assign` | 自動指派票券 | `!auto_assign 123` |
| `!workload` | 查看客服工作量 | `!workload @客服員` |
| `!add_specialty` | 設定客服專精 | `!add_specialty @客服 技術支援 expert` |
| `!assign_stats` | 查看指派統計 | `!assign_stats 30` |

#### 🏷️ 標籤管理指令 (管理員)
| 指令 | 描述 | 範例 |
|------|------|------|
| `!tag` | 查看標籤列表 | `!tag` |
| `!tag create` | 創建新標籤 | `!tag create bug 錯誤回報` |
| `!tag delete` | 刪除標籤 | `!tag delete bug` |
| `!tag init` | 初始化預設標籤 | `!tag init` |

#### 📊 統計面板指令 (管理員)
| 指令 | 描述 | 範例 |
|------|------|------|
| `!dashboard` | 統計面板 | `!dashboard 30` |
| `!report` | 統計摘要報告 | `!report 7` |

#### 用戶指令 (斜線指令)
| 指令 | 描述 | 範例 |
|------|------|------|
| `/close` | 關閉票券 | `/close reason:已解決` |
| `/ticket_info` | 查看票券詳細資訊 | `/ticket_info ticket_id:123` |
| `/tickets` | 查看票券列表 | `/tickets status:open priority:high tag:urgent` |
| `/set_priority` | 設定票券優先級 | `/set_priority priority:high` |
| `/add_tag` | 為票券添加標籤 | `/add_tag tag_name:urgent` |
| `/remove_tag` | 從票券移除標籤 | `/remove_tag tag_name:urgent` |
| `/realtime_stats` | 查看實時統計 | `/realtime_stats` |

### 🗳️ 投票系統指令

| 指令 | 描述 | 範例 |
|------|------|------|
| `/vote` | 建立新投票（引導式） | `/vote` |
| `/votes` | 查看進行中的投票 | `/votes` |
| `/vote_result` | 查看投票結果 | `/vote_result vote_id:5` |
| `/vote_detail` | 查看投票詳細資訊 | `/vote_detail vote_id:5` |
| `/vote_history` | 查看投票歷史 | `/vote_history` |
| `/my_votes` | 查看個人投票記錄 | `/my_votes` |
| `/vote_search` | 搜尋投票 | `/vote_search keyword:活動` |

### 🔧 系統指令 (Bot擁有者限定)

| 指令 | 描述 | 範例 |
|------|------|------|
| `!status` | 查看Bot運行狀態 | `!status` |
| `!health` | 執行系統健康檢查 | `!health` |
| `!dbstatus` | 查看資料庫狀態 | `!dbstatus` |
| `!reload` | 重新載入擴展模組 | `!reload ticket_core` |
| `!sync` | 同步斜線指令 | `!sync` |

## 📊 已實裝功能詳情

### 🎫 票券系統特色

#### 智能票券面板
- 🎨 互動式選擇界面與優先級選擇
- 🔄 Persistent Views（重啟後依然可用）
- 📝 多種票券類型和優先級選擇
- ⚡ 即時回應和自動標籤應用
- 🏷️ 視覺化優先級標識（頻道名稱emoji）

#### 完整權限管理
- 👤 **一般用戶**：建立和查看自己的票券、選擇優先級
- 🛠️ **客服人員**：處理所有票券、指派管理、標籤操作
- 👑 **管理員**：完整系統設定、統計面板、標籤管理

#### 智能指派系統
- 🎯 **多種指派演算法**：最少工作量、輪流指派、專精匹配
- 📊 **工作量追蹤**：實時工作量監控和平衡分析
- 🎖️ **客服專精系統**：技能等級和專業領域匹配
- 📈 **績效統計**：完成率、處理時間、效率分析

#### 優先級管理系統
- 🔴🟡🟢 **三級優先級**：高/中/低優先級分類
- 📋 **自動排序**：票券列表按優先級自動排序
- ⚡ **自動處理**：高優先級票券自動指派
- ⏰ **SLA監控**：優先級別對應的處理時間追蹤

#### 標籤分類系統
- 🏷️ **靈活標籤管理**：系統、部門、自定義標籤分類
- 🤖 **自動標籤規則**：關鍵字、票券類型、用戶角色觸發
- 🔍 **標籤篩選**：票券列表支援標籤篩選功能
- 📊 **使用統計**：標籤使用頻率和熱門度分析

#### 綜合統計面板
- 📊 **實時統計**：當前票券狀況和客服狀態
- 📈 **趨勢分析**：與上期比較的變化趨勢
- 👥 **團隊績效**：客服工作量分佈和平衡分數
- 🏷️ **標籤洞察**：標籤使用率和熱門度分析
- 📝 **報告導出**：文字格式統計摘要報告

#### 資料完整性與追蹤
- 💾 完整的票券生命週期記錄
- 📊 評分和回饋系統
- 🕐 建立時間和處理時間追蹤
- 📋 指派歷史和操作日誌
- 🏷️ 標籤應用歷史和統計

### 🗳️ 投票系統特色

#### 靈活的投票類型
- ☑️ 單選投票（按鈕式）
- ☑️ 多選投票（下拉選單式）
- 🕵️ 匿名/實名投票選擇
- ⏰ 自定義投票時長

#### 強大的管理功能
- 👥 角色權限控制
- 📊 即時統計和視覺化
- 📝 完整的投票歷史
- 🔍 關鍵字搜尋功能

#### 用戶友善界面
- 🎯 步驟式建立引導
- 📋 清晰的結果展示
- 🔄 動態更新統計
- 💬 個人投票記錄查詢

## 🗺️ 開發路線圖

### 🎯 近期目標 (未來 1-2 個月)

#### ✅ 票券系統 v1.2 - 已完成！
- [x] **票券指派系統** ✅
  - 客服人員指派功能
  - 工作量追蹤
  - 指派歷史記錄

- [x] **優先級管理** ✅
  - 三級優先級系統（高/中/低）
  - 視覺化優先級標識
  - 優先級自動排序

- [x] **基礎標籤系統** ✅
  - 票券分類標籤
  - 標籤篩選功能
  - 自定義標籤管理

#### ✅ 統計系統 v1.0 - 已完成！
- [x] **基礎統計面板** ✅
  - 票券處理統計
  - 客服工作量概覽
  - 績效趋勢分析

- [x] **即時監控** ✅
  - 實時統計查看
  - 統計摘要報告
  - 多維度數據分析

#### 🚧 下一階段目標
- [ ] **自動化系統**
  - SLA 超時自動警告
  - 自動回覆系統
  - 批次操作工具

- [ ] **高級報表**
  - CSV/Excel 格式導出
  - 圖表視覺化
  - 定期報告推送

### 🚀 中期目標 (未來 3-6 個月)

#### 自動化系統 v1.0
- [ ] **自動回覆系統**
  - 關鍵字觸發機制
  - 回覆規則管理
  - 智能回覆建議

- [ ] **SLA 監控系統**
  - 回應時間追蹤
  - 超時警告通知
  - SLA 達標率統計

- [ ] **工作流程自動化**
  - 自動客服分配
  - 閒置票券自動關閉
  - 批次操作工具

#### 進階功能擴展
- [ ] **回覆模板系統**
  - 常用回覆模板庫
  - 個人化模板管理
  - 快捷回覆功能

- [ ] **進階搜尋系統**  
  - 全文檢索功能
  - 複合條件篩選
  - 搜尋結果高亮

### 🌟 長期目標 (未來 6+ 個月)

#### 企業級功能
- [ ] **多語言支援**
  - 界面本地化
  - 動態語言切換
  - 多時區支援

- [ ] **API 整合系統**
  - RESTful API 接口
  - Webhook 支援
  - 第三方服務整合

- [ ] **高級分析工具**
  - 機器學習驅動的洞察
  - 預測性分析
  - 客戶行為分析

#### 系統優化
- [ ] **性能優化**
  - 查詢優化
  - 快取策略改進
  - 負載均衡支援

- [ ] **安全強化**
  - 操作審計日誌
  - 敏感資料加密
  - 安全掃描工具

## 🤝 參與開發

### 📋 待開發功能認領

我們歡迎社群參與開發！以下是可以認領的功能：

#### 🟢 入門級 (適合新手)
- [ ] **UI 美化改進** - 改善嵌入訊息樣式
- [ ] **錯誤訊息優化** - 更友善的錯誤提示
- [ ] **文檔完善** - 補充使用說明和範例
- [ ] **測試案例編寫** - 單元測試和整合測試

#### 🟡 中級 (需要一定經驗)
- [ ] **票券指派系統** - 實現客服指派功能
- [ ] **基礎統計面板** - 資料視覺化展示
- [ ] **標籤系統** - 票券分類標籤功能
- [ ] **批次操作工具** - 多票券批次處理

#### 🔴 高級 (需要豐富經驗)
- [ ] **自動回覆系統** - 智能關鍵字匹配
- [ ] **SLA 監控系統** - 實時監控和警告
- [ ] **進階搜尋功能** - 全文檢索實現
- [ ] **API 系統設計** - RESTful API 架構

### 🛠️ 開發環境設定

```bash
# 複製專案
git clone <repository_url>
cd potato-discord-bot

# 建立虛擬環境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安裝開發依賴
pip install -r requirements-dev.txt

# 設定預提交勾子
pre-commit install

# 執行測試
python -m pytest tests/
```

### 📝 代碼規範

- **代碼風格**：使用 Black 進行格式化
- **類型提示**：所有函數都需要類型提示
- **文檔字符串**：使用 Google 風格的文檔字符串
- **測試覆蓋率**：新功能需要達到 80% 以上測試覆蓋率
- **中文註解**：代碼註解優先使用中文

### 🎯 貢獻方式

1. **🐛 回報問題** - 在 Issues 中詳細描述遇到的問題
2. **💡 功能建議** - 提出新功能的想法和用例
3. **📝 改善文檔** - 補充或改善現有文檔
4. **🔧 提交代碼** - Fork 專案並提交 Pull Request
5. **🧪 測試功能** - 協助測試新功能和回報 Bug

## 📈 專案統計

### 📊 代碼統計
- **總行數**：~15,000+ 行
- **Python 文件**：30+ 個
- **功能模組**：8 個主要模組
- **資料庫表**：20+ 個表
- **服務層**：4 個管理器
- **DAO 層**：6 個資料存取層

### 🎯 功能完成度
- **✅ 票券系統核心**：100% 完成
- **✅ 票券指派系統**：100% 完成
- **✅ 優先級系統**：100% 完成
- **✅ 標籤系統**：100% 完成
- **✅ 統計面板**：100% 完成
- **✅ 投票系統**：95% 完成  
- **🚧 自動化系統**：30% 完成（SLA監控已實現）
- **🔮 高級報表**：20% 完成
- **🔮 進階功能**：15% 完成

### 📅 開發時程
- **專案啟動**：2024年
- **核心功能完成**：2025年 Q1
- **進階功能**：2025年 Q2-Q3
- **企業級功能**：2025年 Q4

## 🏷️ 版本歷史

### v1.2.0 (當前版本) - 2025年1月
- ✅ **完整的票券系統核心功能**
- ✅ **票券指派系統** - 手動/自動指派、工作量追蹤
- ✅ **客服專精系統** - 技能等級和專業領域匹配
- ✅ **三級優先級系統** - 高/中/低優先級管理
- ✅ **視覺化優先級標識** - emoji標識和自動排序
- ✅ **標籤分類系統** - 靈活標籤管理和自動應用
- ✅ **標籤篩選功能** - 按標籤篩選票券列表
- ✅ **綜合統計面板** - 實時統計和趨勢分析
- ✅ **績效分析系統** - 客服工作量和效率統計
- ✅ **完整的投票系統**
- ✅ **SLA 監控系統** - 自動超時檢查和通知
- ✅ **基礎錯誤處理和日誌系統**
- ✅ **Persistent Views 支援**
- ✅ **完整權限管理**
- ✅ **資料庫完整整合**（20+ 資料表）

### v0.8.0 - 2025年1月初
- ✅ 票券系統核心功能
- ✅ 完整的投票系統
- ✅ 基礎錯誤處理和日誌系統
- ✅ Persistent Views 支援
- ✅ 基本權限管理
- ✅ 資料庫完整整合

### v0.7.0 - 2024年12月
- ✅ 投票系統實現
- ✅ 資料庫架構重構
- ✅ UI 組件模組化

### v0.6.0 - 2024年11月  
- ✅ 票券系統基礎功能
- ✅ 資料庫連接池
- ✅ 基本錯誤處理

## 📞 支援與社群

### 🆘 獲得幫助
- **📚 文檔**：查看 `COMMANDS.md` 了解詳細指令用法
- **🐛 問題回報**：在 GitHub Issues 提交問題
- **💬 討論**：在 Discussions 參與社群討論
- **📧 聯繫**：透過專案維護者聯繫方式

### 🤝 社群資源
- **📖 開發文檔**：`docs/` 目錄下的詳細文檔
- **🎓 教學範例**：`examples/` 目錄下的使用範例
- **🧪 測試案例**：`tests/` 目錄下的測試程式碼
- **🛠️ 開發工具**：開源的開發和部署工具

## 📄 授權與致謝

### 📜 授權條款
此專案採用 **MIT License** 開源授權條款。

### 🙏 特別致謝
- **Discord.py 社群** - 提供優秀的 Discord API 封裝
- **所有貢獻者** - 感謝每一位參與開發的開發者
- **測試用戶** - 感謝提供寶貴回饋的用戶們
- **開源社群** - 感謝各種開源工具和資源

---

**🥔 讓 Discord 伺服器管理更簡單，讓社群互動更有趣！**

> 💡 **提示**：查看 `COMMANDS.md` 獲取完整的指令使用說明，或使用 `!ticket_help` 和 `/vote` 開始體驗功能！