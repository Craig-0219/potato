# 🔒 安全設置指南

> 本指南詳細說明 Potato Bot 的安全特性、配置方法和最佳實踐，確保系統和用戶數據的安全。

## 📋 系統安全概覽

Potato Bot 內建多層安全機制，旨在保護系統免受未經授權的訪問、數據洩露和惡意行為。我們採用行業標準的認證、授權和監控技術，為您的社群提供安全的環境。

### 核心安全特性

*   **強大認證與授權**：支援 API 金鑰、JWT 和 Discord OAuth，並實施精細的權限控制。
*   **多因素認證 (MFA)**：為用戶提供額外的登入安全層。
*   **安全監控與審計**：實時監控安全事件，生成合規報告，確保透明度和可追溯性。
*   **內容安全過濾**：自動檢測和過濾有害內容，保護社群免受不當資訊影響。
*   **API 金鑰管理**：安全地生成、管理和撤銷 API 金鑰。

## 🚀 認證與授權

### 1. API 金鑰認證

API 金鑰用於程式化訪問機器人功能，例如與外部應用程式或服務整合。

*   **生成金鑰**：管理員可以透過 Discord 指令生成具有不同權限等級的 API 金鑰。
    ```
    /create-api-key name:[應用名稱]
    ```
*   **權限等級**：API 金鑰支援以下權限等級：
    *   `READ_ONLY`：只讀取數據。
    *   `WRITE`：讀寫數據。
    *   `ADMIN`：管理員操作。
    *   `SUPER_ADMIN`：最高管理權限。
*   **使用方式**：在 API 請求的 `Authorization` 頭部使用 `Bearer <your_api_key>`。
*   **管理金鑰**：
    ```
    /api_key_management
    ```

### 2. Discord OAuth2 認證

Web 介面登入透過 Discord OAuth2 實現，確保用戶身份的安全性。

*   **流程**：用戶被重定向到 Discord 進行授權，然後返回機器人 Web 介面並獲得 JWT 令牌。
*   **權限映射**：用戶在 Discord 伺服器中的角色（例如管理員、客服）會被映射到 API 的權限等級。
*   **JWT 令牌**：用於 Web 介面與後端 API 之間的認證。

### 3. 角色基礎訪問控制 (RBAC)

系統實施 RBAC，確保用戶只能訪問其被授權的功能。

*   **角色管理**：管理員可以管理系統角色和用戶權限。
    ```
    /role_management
    ```
*   **分配角色**：
    ```
    /assign_role user: @用戶 role_name: <角色名稱> [expires_days: 天數]
    ```

## 🔐 多因素認證 (MFA)

MFA 為您的帳戶提供額外的安全層，即使密碼洩露也能有效防禦。

*   **設置 MFA**：
    ```
    /mfa_setup
    ```
    系統會引導您使用認證應用程式（如 Google Authenticator）掃描 QR Code 或手動輸入密鑰。
*   **查看 MFA 狀態**：
    ```
    /mfa_status
    ```

## 📊 安全監控與審計

### 1. 安全儀表板

提供系統安全狀態的綜合概覽。

```
/security_dashboard
```

### 2. 安全事件記錄

記錄所有安全相關的事件，便於追溯和分析。

```
/security_events [event_type: 事件類型] [risk_level: 風險等級] [user: @用戶] [days: 天數]
```

### 3. 安全警報

實時監控並顯示活躍的安全警報。

```
/security_alerts [severity: 嚴重程度]
```

### 4. 合規報告

生成符合各種行業標準的合規報告，例如 GDPR、SOX、ISO27001 等。

```
/compliance_report standard: <合規標準> [days: 天數]
```

### 5. 合規歷史

查看過去生成的合規報告歷史記錄。

```
/compliance_history [standard: 合規標準]
```

## 🛡️ 內容安全

AI 助手和內容分析服務內建了強大的內容安全機制。

*   **AI 提示詞過濾**：AI 服務會自動過濾包含暴力、色情、仇恨言論等敏感內容的用戶提示詞。
*   **內容安全檢查**：
    *   **情感分析** (`/analyze_sentiment`)：分析文本情感傾向。
    *   **毒性檢測** (`/check_content`)：識別文本中的有害內容和毒性分數。
    *   **連結安全分析** (`/analyze_links`)：檢查 URL 的安全性，識別惡意連結和短網址。
    *   **綜合分析** (`/comprehensive_analysis`)：提供文本的全面安全報告。

## 🛠️ 安全配置與最佳實踐

### 1. 環境變數管理

*   **敏感資訊**：`JWT_SECRET`、`DISCORD_CLIENT_SECRET`、`OPENAI_API_KEY` 等敏感資訊應儲存在環境變數中，切勿直接寫入程式碼或提交到版本控制。
*   **`.env` 文件**：使用 `.env` 文件管理本地開發環境的變數，並確保其不被 Git 追蹤。

### 2. API 金鑰管理

*   **最小權限原則**：為每個應用程式或服務生成專用的 API 金鑰，並僅賦予其完成任務所需的最低權限。
*   **定期輪換**：建議每 3-6 個月輪換 API 金鑰，以降低洩露風險。
*   **安全儲存**：將 API 金鑰儲存在安全的環境中，避免硬編碼。
*   **監控使用**：定期審查 API 金鑰的使用日誌，及時發現異常行為。

### 3. 伺服器與機器人權限

*   **Discord 機器人權限**：僅賦予機器人完成其功能所需的最低 Discord 權限。過多的權限會增加安全風險。
*   **伺服器管理**：確保只有受信任的管理員才能訪問機器人的管理指令和配置。
*   **日誌監控**：定期檢查機器人日誌和伺服器審計日誌，尋找可疑活動。

### 4. 防火牆與網路安全

*   **端口限制**：僅開放必要的網路端口（例如 API 服務的端口）。
*   **IP 白名單**：對於敏感的 API 端點，考慮限制只有特定 IP 地址才能訪問。
*   **SSL/TLS**：確保所有 Web 流量都透過 HTTPS 加密。

### 5. 定期安全審計

*   **程式碼審查**：定期進行程式碼安全審查，發現潛在漏洞。
*   **依賴掃描**：使用工具掃描第三方依賴庫的已知漏洞。
*   **合規性檢查**：定期生成合規報告，確保系統符合相關安全標準。
