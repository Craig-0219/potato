# 🛠️ 故障排除指南

> 本指南提供 Potato Bot 常見問題的診斷與解決方案，幫助您快速恢復服務。

## 📋 快速診斷

當您遇到問題時，請先嘗試以下快速檢查：

1.  **檢查機器人狀態**：
    *   確認機器人是否在線（Discord 綠點）。
    *   使用 `/ping` 指令測試機器人回應。
    *   使用 `/status` 指令查看機器人運行時間和基本狀態。
2.  **檢查日誌**：
    *   查看 `bot.log` 文件，尋找錯誤訊息或警告。
    *   日誌文件通常位於機器人運行目錄下。
3.  **檢查環境變數**：
    *   確認 `.env` 文件中的 `DISCORD_TOKEN`、資料庫設定等關鍵變數是否正確。
    *   確保 `LOG_LEVEL` 設定為 `DEBUG` 以獲取更詳細的日誌。
4.  **檢查網路連接**：
    *   確認伺服器可以訪問 Discord 和資料庫服務。

## 🚨 常見問題與解決方案

### 1. 機器人無法啟動

*   **錯誤訊息**：`❌ 未找到 DISCORD_TOKEN`
    *   **原因**：`.env` 文件中未設定 `DISCORD_TOKEN` 或設定錯誤。
    *   **解決方案**：在 `.env` 文件中填寫正確的 Discord Bot Token。
*   **錯誤訊息**：`❌ 缺少模組` 或 `ImportError`
    *   **原因**：Python 依賴未安裝或安裝不完整。
    *   **解決方案**：確保您已啟動虛擬環境並執行 `pip install -r requirements.txt`。
*   **錯誤訊息**：`❌ 資料庫設定不完整` 或 `Database connection failed`
    *   **原因**：資料庫服務未運行，或 `.env` 中的資料庫連接資訊錯誤。
    *   **解決方案**：
        1.  確認您的 MySQL/PostgreSQL 服務正在運行。
        2.  檢查 `DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`, `DB_NAME` 等設定是否正確。
        3.  使用 `!dbstatus` 指令檢查資料庫連接狀態。
*   **錯誤訊息**：`❌ Bot 設定失敗`
    *   **原因**：啟動過程中發生了未預期的錯誤。
    *   **解決方案**：查看 `bot.log` 文件獲取詳細錯誤訊息，並嘗試重啟機器人。

### 2. 指令沒有回應或權限不足

*   **問題現象**：機器人沒有回應斜線指令 (`/`) 或文字指令 (`!`)。
    *   **原因**：
        1.  機器人離線。
        2.  機器人沒有足夠的權限（例如，沒有讀取或發送訊息的權限）。
        3.  指令名稱錯誤或參數格式不正確。
        4.  指令處於冷卻時間。
    *   **解決方案**：
        1.  確認機器人已在線。
        2.  檢查機器人在 Discord 伺服器中的角色權限。
        3.  使用 `/help <指令名>` 查看正確的指令用法和參數。
        4.  等待冷卻時間結束。
*   **錯誤訊息**：`❌ 你沒有權限使用此命令` 或 `❌ 機器人缺少必要權限`
    *   **原因**：您的 Discord 帳戶沒有執行該指令所需的權限，或機器人本身缺少執行操作所需的權限。
    *   **解決方案**：
        1.  聯繫伺服器管理員，請求賦予相應權限。
        2.  管理員應檢查機器人在伺服器中的角色權限，確保其擁有 `manage_guild`, `read_messages`, `send_messages` 等必要權限。

### 3. API 服務問題

*   **問題現象**：無法訪問 Web 介面或 API 端點。
    *   **原因**：API 服務器未啟動，或防火牆阻擋了連接。
    *   **解決方案**：
        1.  確認 `ENABLE_API_SERVER` 環境變數設定為 `true`。
        2.  檢查 `bot.log` 中是否有 API 服務器啟動失敗的錯誤。
        3.  確認伺服器防火牆允許 `API_PORT` (預設 8000) 的流量。
        4.  使用 `curl http://localhost:8000/health` 測試 API 健康狀態。
*   **錯誤訊息**：`401 Unauthorized` 或 `403 Forbidden`
    *   **原因**：API 認證失敗或權限不足。
    *   **解決方案**：
        1.  確認您使用的 API Token 或金鑰是有效的。
        2.  檢查您的帳戶是否具有執行該操作的權限。
        3.  參考 `API 參考文檔` 了解正確的認證方式。

## 🔍 診斷工具與日誌

### 1. 機器人內建指令

*   `/status`：查看機器人運行時間、伺服器數量、延遲等基本狀態。
*   `!dbstatus`：查看資料庫連接狀態和基本統計。
*   `!healthcheck`：執行詳細的系統健康檢查，包括資料庫、命令同步、擴展載入等。
*   `/ai_status`：查看 AI 系統的運行狀態和統計。
*   `/ticket_stats`：查看票券系統的統計概覽。
*   `!ai stats`：查看 AI 服務的總體使用統計。

### 2. 日誌文件

*   **`bot.log`**：主日誌文件，記錄機器人運行中的所有訊息、警告和錯誤。
    *   **位置**：通常在機器人運行目錄下。
    *   **查看方式**：`tail -f bot.log` (Linux/macOS) 或使用文本編輯器。
*   **日誌等級**：您可以透過設定 `LOG_LEVEL` 環境變數來調整日誌的詳細程度：
    *   `DEBUG`：最詳細的日誌，包含所有調試訊息。
    *   `INFO`：一般資訊性訊息。
    *   `WARNING`：潛在問題或非關鍵錯誤。
    *   `ERROR`：錯誤訊息。
    *   `CRITICAL`：嚴重錯誤，可能導致應用程式停止。

### 3. 錯誤統計

機器人會自動收集錯誤統計。管理員可以使用 `!ai stats` 或 `!dashboard` 等指令查看錯誤概覽。

## 🆘 獲取協助

如果您無法自行解決問題，請提供以下資訊以獲得更快的支援：

1.  **問題描述**：詳細說明您遇到的問題現象。
2.  **重現步驟**：如何觸發該問題（如果可以重現）。
3.  **錯誤訊息**：提供完整的錯誤訊息截圖或文本。
4.  **日誌片段**：從 `bot.log` 中複製相關的錯誤日誌片段。
5.  **環境資訊**：
    *   作業系統 (OS)
    *   Python 版本
    *   機器人版本 (如果知道)
    *   您嘗試執行的指令或 API 請求。
6.  **您已嘗試的解決方案**：說明您已經嘗試過哪些方法。
