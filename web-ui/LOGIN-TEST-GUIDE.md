# API Key 登录测试指南

## 🤖 Discord Bot API 密钥

系统现已完全集成 Discord Bot 的 API 密钥系统！

### 获取真实 API 密钥
1. **在 Discord 伺服器中使用指令**：
   ```
   /create_api_key name:WebUI expires_days:30
   ```

2. **Bot 会私讯您完整的 API 密钥**：
   - 格式：`key_id.key_secret`
   - 例如：`A1B2C3D4E5F6G7H8.I9J0K1L2M3N4O5P6Q7R8S9T0U1V2W3X4Y5Z6`

3. **复制完整密钥到登录页面**

### 权限系统
- **管理员**：拥有所有权限 (`['all']`)
- **客服人员**：拥有票券和统计权限 (`['tickets.read', 'tickets.write', 'statistics.read']`)
- **一般用户**：只能查看自己的票券 (`['tickets.read_own']`)

## 🔑 测试用 API 密钥（开发环境）

如果无法连接到 Discord Bot，系统提供以下测试密钥：

### 管理员账户
```
potato-admin-key-123
```
- **角色**: 管理员
- **权限**: 完整权限 (read, write, delete, admin)
- **用户名**: Administrator

### 员工账户
```
potato-staff-key-456
```
- **角色**: 员工
- **权限**: 读写权限 (read, write)
- **用户名**: Staff Member

## 🚀 登录步骤

1. **访问登录页面**: 浏览 `http://localhost:3000`
2. **输入 API 密钥**: 复制上述任一密钥到输入框
3. **点击登录**: 系统会显示"登入成功！正在跳轉..."
4. **自动重定向**: 1秒后自动跳转到 `/dashboard`

## 🔍 调试信息

系统现在会在浏览器控制台显示详细的调试信息：

- `🔍 檢查認證狀態:` - 页面加载时的认证检查
- `✅ API 金鑰登入成功:` - 登录成功信息
- `✅ 恢復用戶認證狀態:` - 页面刷新时的状态恢复
- `🔄 用戶已認證，重定向到儀表板` - 认证后的重定向

## 🛠️ 功能验证

登录成功后，您可以验证：

1. **认证状态**: 导航栏显示用户名和头像
2. **Bot 连接**: 导航栏显示 Bot 连接状态指示器
3. **页面访问**: 所有受保护的页面都可正常访问
4. **会话持久**: 刷新页面后仍保持登录状态

## ❌ 故障排除

### 登录后仍跳回登录页面

**可能原因:**
- 浏览器禁用了 cookies
- 隐私模式或无痕模式
- 本地存储被清除

**解决方法:**
1. 启用浏览器 cookies
2. 使用正常浏览模式
3. 清除浏览器缓存后重试

### API 密钥验证失败

**可能原因:**
- 输入了错误的密钥
- 复制时包含了额外空格

**解决方法:**
1. 确保完全复制正确的密钥
2. 检查没有多余的空格或字符

### 页面无法访问

**可能原因:**
- 开发服务器未启动
- 端口被占用

**解决方法:**
1. 运行 `npm run dev` 启动开发服务器
2. 确认访问 `http://localhost:3000`

## 🎯 下一步

登录成功后，您可以：

1. **查看仪表板**: 管理面板主页
2. **系统监控**: 访问 `/system-monitor` 查看 Bot 连接状态
3. **票券管理**: 查看票券系统功能
4. **投票统计**: 实时投票数据展示
5. **分析报告**: 系统数据分析

## 🔐 生产环境

在生产环境中：
- 使用真实的 API 密钥验证服务
- 配置适当的环境变量
- 启用 HTTPS 安全连接
- 设置合适的会话过期时间

---

**注意**: 测试密钥仅用于开发环境，生产环境请使用真实的 API 密钥管理系统。