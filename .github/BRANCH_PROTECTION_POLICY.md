# Branch Protection Policy

## ğŸ›¡ï¸ åˆ†æ”¯ä¿è­·æ©Ÿåˆ¶

ç‚ºäº†ç¶­è­·ä»£ç¢¼å“è³ªå’Œé˜²æ­¢æ„å¤–çš„åˆ†æ”¯åˆä½µï¼Œæœ¬å°ˆæ¡ˆå¯¦æ–½ä»¥ä¸‹åˆ†æ”¯ä¿è­·æ”¿ç­–ï¼š

## ğŸ“‹ åˆ†æ”¯æ¶æ§‹

```
main (ç”Ÿç”¢ç’°å¢ƒ)
â”œâ”€â”€ ptero (éƒ¨ç½²åˆ†æ”¯)
â””â”€â”€ dev (é–‹ç™¼åˆ†æ”¯)
    â”œâ”€â”€ feature/* (åŠŸèƒ½åˆ†æ”¯)
    â”œâ”€â”€ bugfix/* (ä¿®å¾©åˆ†æ”¯)
    â””â”€â”€ hotfix/* (ç·Šæ€¥ä¿®å¾©ï¼Œå¯ç›´æ¥åˆä½µåˆ° main)
```

## ğŸš« ç¦æ­¢çš„æ“ä½œ

### 1. ç›´æ¥åˆä½µ dev â†’ main
- **åŸå› **: ç¹éè‡ªå‹•åŒ–æ¸¬è©¦å’Œå“è³ªæª¢æŸ¥
- **æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨ smart-auto-merge workflow
- **è§¸ç™¼æ–¹å¼**: æ¨é€åˆ° dev åˆ†æ”¯æ™‚è‡ªå‹•åŸ·è¡Œ

### 2. ç›´æ¥åˆä½µ main â†’ dev âš ï¸ æ–°å¢
- **åŸå› **: é˜²æ­¢ main åˆ†æ”¯çš„è®Šæ›´è¦†è“‹ dev åˆ†æ”¯çš„é–‹ç™¼å·¥ä½œ
- **é¢¨éšª**: å¯èƒ½å°è‡´ dev åˆ†æ”¯çš„åŠŸèƒ½å’Œæ¸¬è©¦è¢«æ„å¤–åˆªé™¤
- **æ­£ç¢ºåšæ³•**: å¾ main å‰µå»º feature åˆ†æ”¯ï¼Œç„¶å¾Œåˆä½µåˆ° dev

### 3. Feature/Bugfix åˆ†æ”¯ç›´æ¥åˆä½µåˆ° main
- **åŸå› **: æ‡‰å…ˆç¶“é dev åˆ†æ”¯çš„æ•´åˆæ¸¬è©¦
- **æ­£ç¢ºæµç¨‹**: feature/bugfix â†’ dev â†’ main

## âœ… å…è¨±çš„æ“ä½œ

### 1. è‡ªå‹•åˆä½µæµç¨‹ (æ¨è–¦)
```bash
# é–‹ç™¼å®Œæˆå¾Œæ¨é€åˆ° dev
git push origin dev
# smart-auto-merge workflow è‡ªå‹•åŸ·è¡Œï¼š
# 1. é¢¨éšªè©•ä¼°
# 2. å®Œæ•´æ¸¬è©¦
# 3. è‡ªå‹•åˆä½µåˆ° main
# 4. éƒ¨ç½²åˆ° ptero
```

### 2. åŠŸèƒ½é–‹ç™¼æµç¨‹
```bash
# å‰µå»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-awesome-feature dev
# é–‹ç™¼å®Œæˆå¾Œ
git push origin feature/new-awesome-feature
# å‰µå»º PR: feature/new-awesome-feature â†’ dev
```

### 3. ç·Šæ€¥ä¿®å¾©æµç¨‹
```bash
# å‰µå»ºç†±ä¿®å¾©åˆ†æ”¯
git checkout -b hotfix/critical-security-fix main
# ä¿®å¾©å®Œæˆå¾Œ
git push origin hotfix/critical-security-fix
# å‰µå»º PR: hotfix/critical-security-fix â†’ main (å…è¨±)
```

### 4. è™•ç† main åˆ†æ”¯çš„è®Šæ›´ (æ–°å¢)
```bash
# å¦‚æœ main åˆ†æ”¯æœ‰ç·Šæ€¥ä¿®å¾©éœ€è¦åŒæ­¥åˆ° dev
# ä¸è¦ç›´æ¥åˆä½µ main â†’ devï¼Œè€Œæ˜¯ï¼š

# 1. å¾ main å‰µå»º feature åˆ†æ”¯
git checkout -b feature/sync-main-hotfix main

# 2. å°‡æ­¤åˆ†æ”¯åˆä½µåˆ° dev
git checkout dev
git merge feature/sync-main-hotfix

# 3. åˆªé™¤è‡¨æ™‚åˆ†æ”¯
git branch -d feature/sync-main-hotfix
```

## ğŸ”§ å¯¦æ–½æ©Ÿåˆ¶

### GitHub Actions å·¥ä½œæµç¨‹
- **branch-protection.yml**: è‡ªå‹•æª¢æŸ¥å’Œé˜»æ­¢é•è¦åˆä½µ
- **smart-auto-merge.yml**: æ™ºèƒ½è‡ªå‹•åˆä½µç³»çµ±

### æª¢æŸ¥é …ç›®
1. **åˆ†æ”¯å‘½åè¦ç¯„æª¢æŸ¥**
2. **ç›®æ¨™åˆ†æ”¯é©—è­‰**
3. **åˆä½µè·¯å¾‘é©—è­‰**
4. **é¢¨éšªè©•ä¼°**

## ğŸ“Š ä¿è­·æ•ˆæœ

| æºåˆ†æ”¯ | ç›®æ¨™åˆ†æ”¯ | ç‹€æ…‹ | èªªæ˜ |
|--------|----------|------|------|
| dev | main | âŒ é˜»æ­¢ | ä½¿ç”¨ smart-auto-merge |
| main | dev | âŒ é˜»æ­¢ | é˜²æ­¢è³‡æ–™è¦†è“‹ âš ï¸ æ–°å¢ |
| feature/* | main | âŒ é˜»æ­¢ | æ‡‰åˆä½µåˆ° dev |
| bugfix/* | main | âŒ é˜»æ­¢ | æ‡‰åˆä½µåˆ° dev |
| hotfix/* | main | âœ… å…è¨± | ç·Šæ€¥ä¿®å¾© |
| feature/* | dev | âœ… å…è¨± | æ¨™æº–é–‹ç™¼æµç¨‹ |
| bugfix/* | dev | âœ… å…è¨± | æ¨™æº–ä¿®å¾©æµç¨‹ |

## ğŸ› ï¸ ç¹éæ©Ÿåˆ¶ (åƒ…ç·Šæ€¥æƒ…æ³)

å¦‚æœå¿…é ˆç¹éä¿è­·æ©Ÿåˆ¶ï¼š

```bash
# åƒ…é©ç”¨æ–¼ç·Šæ€¥æƒ…æ³
git push origin dev --force-with-lease
# æˆ–è€…
git push origin main --force-with-lease
```

**âš ï¸ è­¦å‘Š**: åƒ…åœ¨ç³»çµ±æ•…éšœæˆ–å…¶ä»–ç·Šæ€¥æƒ…æ³ä¸‹ä½¿ç”¨

## ğŸ“ æ”¯æ´

å¦‚æœé‡åˆ°åˆ†æ”¯ä¿è­·ç›¸é—œå•é¡Œï¼š
1. æª¢æŸ¥åˆ†æ”¯å‘½åæ˜¯å¦ç¬¦åˆè¦ç¯„
2. ç¢ºèªåˆä½µç›®æ¨™åˆ†æ”¯æ˜¯å¦æ­£ç¢º
3. æŸ¥çœ‹ GitHub Actions åŸ·è¡Œæ—¥èªŒ
4. è¯ç¹«å°ˆæ¡ˆç¶­è­·è€…