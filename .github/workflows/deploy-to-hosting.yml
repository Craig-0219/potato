name: ğŸš€ Deploy to Hosting & Auto Update

# è¨­å®šå·¥ä½œæµç¨‹æ¬Šé™
permissions:
  contents: write
  issues: write
  pull-requests: write

# ç•¶ main åˆ†æ”¯æœ‰æ¨é€æ™‚è§¸ç™¼éƒ¨ç½²
on:
  push:
    branches: [main]
    paths-ignore:
      - 'docs/**'
      - '*.md'
      - '.github/**'

  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:
    inputs:
      deployment_environment:
        description: 'éƒ¨ç½²ç’°å¢ƒ'
        required: true
        default: 'production'
        type: choice
        options:
        - production
        - staging
      force_deploy:
        description: 'å¼·åˆ¶éƒ¨ç½² (è·³éå¥åº·æª¢æŸ¥)'
        required: false
        default: false
        type: boolean
      notify_hosting:
        description: 'é€šçŸ¥è¨—ç®¡å•†æ›´æ–°'
        required: false
        default: true
        type: boolean

env:
  NODE_VERSION: '18'
  PYTHON_VERSION: '3.10'

jobs:
  # ================================
  # éšæ®µ 1: éƒ¨ç½²å‰é©—è­‰
  # ================================
  pre-deployment-check:
    name: ğŸ” éƒ¨ç½²å‰é©—è­‰
    runs-on: ubuntu-latest
    outputs:
      deploy_ready: ${{ steps.check.outputs.deploy_ready }}
      version_tag: ${{ steps.version.outputs.tag }}
      commit_hash: ${{ steps.version.outputs.commit_hash }}

    steps:
    - name: ğŸ“¥ Checkout Main Branch
      uses: actions/checkout@v4
      with:
        ref: main
        fetch-depth: 10

    - name: ğŸ·ï¸ Generate Version Tag
      id: version
      run: |
        # ç”Ÿæˆç‰ˆæœ¬æ¨™ç±¤
        TIMESTAMP=$(date -u '+%Y%m%d-%H%M%S')
        COMMIT_HASH=$(git rev-parse --short HEAD)
        VERSION_TAG="v${TIMESTAMP}-${COMMIT_HASH}"

        echo "Generated version: $VERSION_TAG"
        echo "tag=$VERSION_TAG" >> $GITHUB_OUTPUT
        echo "commit_hash=$COMMIT_HASH" >> $GITHUB_OUTPUT

    - name: ğŸ” Deployment Readiness Check
      id: check
      run: |
        echo "ğŸ” æª¢æŸ¥éƒ¨ç½²æº–å‚™ç‹€æ…‹..."

        READY=true

        # æª¢æŸ¥æ ¸å¿ƒæ–‡ä»¶
        if [[ ! -f "bot/main.py" ]]; then
          echo "âŒ ç¼ºå°‘ bot/main.py"
          READY=false
        fi

        if [[ ! -f "requirements.txt" ]]; then
          echo "âŒ ç¼ºå°‘ requirements.txt"
          READY=false
        fi

        if [[ ! -f "start.py" ]]; then
          echo "âŒ ç¼ºå°‘ start.py"
          READY=false
        fi

        # æª¢æŸ¥ Dockerfile (å¦‚æœå­˜åœ¨)
        if [[ -f "Dockerfile" ]]; then
          echo "âœ… ç™¼ç¾ Dockerfile"
        fi

        # æª¢æŸ¥æœ€è¿‘æäº¤æ˜¯å¦åŒ…å« [skip-deploy] æ¨™è¨˜
        LATEST_COMMIT=$(git log -1 --pretty=%B)
        if echo "$LATEST_COMMIT" | grep -q "\[skip-deploy\]"; then
          echo "ğŸš« æäº¤åŒ…å« [skip-deploy] æ¨™è¨˜"
          READY=false
        fi

        if [[ "$READY" == "true" ]] || [[ "${{ inputs.force_deploy }}" == "true" ]]; then
          echo "âœ… éƒ¨ç½²æº–å‚™å°±ç·’"
          echo "deploy_ready=true" >> $GITHUB_OUTPUT
        else
          echo "âŒ éƒ¨ç½²æº–å‚™æœªå®Œæˆ"
          echo "deploy_ready=false" >> $GITHUB_OUTPUT
        fi

  # ================================
  # éšæ®µ 2: éƒ¨ç½²åˆ° Ptero åˆ†æ”¯
  # ================================
  deploy-to-ptero:
    name: ğŸ¦• éƒ¨ç½²åˆ° Ptero åˆ†æ”¯
    needs: pre-deployment-check
    if: needs.pre-deployment-check.outputs.deploy_ready == 'true'
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout Main Branch
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: âš™ï¸ Configure Git
      run: |
        git config user.name "GitHub Actions Deploy Bot"
        git config user.email "deploy@github-actions.com"

    - name: ğŸ¦• Create/Update Ptero Branch
      run: |
        echo "ğŸ¦• æº–å‚™ Ptero éƒ¨ç½²åˆ†æ”¯..."

        # æª¢æŸ¥ ptero åˆ†æ”¯æ˜¯å¦å­˜åœ¨
        if git ls-remote --heads origin ptero | grep -q ptero; then
          echo "ğŸ“ Ptero åˆ†æ”¯å·²å­˜åœ¨ï¼Œåˆ‡æ›ä¸¦æ›´æ–°"
          git fetch origin ptero
          git checkout ptero

          # é‡ç½®åˆ° main åˆ†æ”¯çš„ç‹€æ…‹
          git reset --hard origin/main
        else
          echo "ğŸ†• å‰µå»ºæ–°çš„ Ptero åˆ†æ”¯"
          git checkout -b ptero
        fi

    - name: ğŸ”§ Optimize for Ptero Deployment
      run: |
        echo "ğŸ”§ é‡å° Ptero ç’°å¢ƒå„ªåŒ–..."

        # å‰µå»º Ptero ç‰¹å®šçš„ç’°å¢ƒé…ç½®
        cat > .ptero_env << 'EOF'
        # Ptero ç’°å¢ƒé…ç½®
        ENVIRONMENT=production
        SYNC_COMMANDS=false
        API_EXTERNAL_ACCESS=true
        DEBUG=false
        LOG_LEVEL=INFO
        ENABLE_PTERO_OPTIMIZATIONS=true
        EOF

        # å‰µå»º Ptero å•Ÿå‹•è…³æœ¬
        cat > ptero_start.sh << 'EOF'
        #!/bin/bash
        # Ptero å°ˆç”¨å•Ÿå‹•è…³æœ¬

        echo "ğŸ¦• Ptero ç’°å¢ƒå•Ÿå‹•ä¸­..."

        # è¨­ç½®ç’°å¢ƒè®Šé‡
        if [ -f ".ptero_env" ]; then
          source .ptero_env
          echo "âœ… è¼‰å…¥ Ptero ç’°å¢ƒè®Šé‡"
        fi

        # å®‰è£ä¾è³´
        if [ -f "requirements.txt" ]; then
          pip install -r requirements.txt
          echo "âœ… å®‰è£ä¾è³´å®Œæˆ"
        fi

        # å•Ÿå‹• Bot
        echo "ğŸš€ å•Ÿå‹• Discord Bot..."
        python bot/main.py
        EOF

        chmod +x ptero_start.sh

        # å‰µå»º Ptero é…ç½®æ–‡ä»¶
        cat > ptero.json << EOF
        {
          "name": "Potato Discord Bot",
          "version": "${{ needs.pre-deployment-check.outputs.version_tag }}",
          "commit": "${{ needs.pre-deployment-check.outputs.commit_hash }}",
          "deployment_time": "$(date -u '+%Y-%m-%d %H:%M:%S UTC')",
          "environment": "${{ inputs.deployment_environment || 'production' }}",
          "ptero_optimized": true,
          "startup_command": "bash ptero_start.sh",
          "requirements": {
            "python": "3.10+",
            "memory": "512MB",
            "cpu": "1 core"
          }
        }
        EOF

        echo "âœ… Ptero å„ªåŒ–é…ç½®å®Œæˆ"

    - name: ğŸ“¤ Push to Ptero Branch
      run: |
        echo "ğŸ“¤ æ¨é€åˆ° Ptero åˆ†æ”¯..."

        git add .
        git commit -m "ğŸ¦• Ptero éƒ¨ç½²æ›´æ–° - ${{ needs.pre-deployment-check.outputs.version_tag }}

        ğŸš€ éƒ¨ç½²ä¿¡æ¯:
        â€¢ ç‰ˆæœ¬: ${{ needs.pre-deployment-check.outputs.version_tag }}
        â€¢ æäº¤: ${{ needs.pre-deployment-check.outputs.commit_hash }}
        â€¢ ç’°å¢ƒ: ${{ inputs.deployment_environment || 'production' }}
        â€¢ æ™‚é–“: $(date -u '+%Y-%m-%d %H:%M:%S UTC')

        âœ… Ptero å„ªåŒ–:
        â€¢ ç”Ÿç”¢ç’°å¢ƒé…ç½®
        â€¢ å„ªåŒ–å•Ÿå‹•è…³æœ¬
        â€¢ è³‡æºéœ€æ±‚é…ç½®
        â€¢ è‡ªå‹•æ›´æ–°æ”¯æŒ

        ğŸ¤– è‡ªå‹•éƒ¨ç½² by GitHub Actions" || echo "ç„¡æ–°è®Šæ›´éœ€è¦æäº¤"

        git push origin ptero --force-with-lease
        echo "âœ… Ptero åˆ†æ”¯æ›´æ–°å®Œæˆ"

  # ================================
  # éšæ®µ 3: é€šçŸ¥è¨—ç®¡å•†æ›´æ–°
  # ================================
  notify-hosting-providers:
    name: ğŸ“¡ é€šçŸ¥è¨—ç®¡å•†è‡ªå‹•æ›´æ–°
    needs: [pre-deployment-check, deploy-to-ptero]
    if: needs.deploy-to-ptero.result == 'success' && (inputs.notify_hosting != false)
    runs-on: ubuntu-latest

    strategy:
      matrix:
        hosting_provider: [pterodactyl, railway, render, heroku]
      fail-fast: false

    steps:
    - name: ğŸ“¡ Send Update Signal to ${{ matrix.hosting_provider }}
      run: |
        echo "ğŸ“¡ ç™¼é€æ›´æ–°ä¿¡è™Ÿåˆ° ${{ matrix.hosting_provider }}..."

        VERSION="${{ needs.pre-deployment-check.outputs.version_tag }}"
        COMMIT="${{ needs.pre-deployment-check.outputs.commit_hash }}"
        BRANCH="ptero"

        case "${{ matrix.hosting_provider }}" in
          "pterodactyl")
            # Pterodactyl Panel Webhook
            if [[ -n "${{ secrets.PTERODACTYL_WEBHOOK_URL }}" ]]; then
              curl -X POST "${{ secrets.PTERODACTYL_WEBHOOK_URL }}" \
                -H "Content-Type: application/json" \
                -H "Authorization: Bearer ${{ secrets.PTERODACTYL_API_KEY }}" \
                -d '{
                  "action": "restart_server",
                  "repository": "potato",
                  "branch": "'$BRANCH'",
                  "version": "'$VERSION'",
                  "commit": "'$COMMIT'",
                  "auto_pull": true
                }' || echo "âš ï¸ Pterodactyl webhook èª¿ç”¨å¤±æ•—"
              echo "âœ… Pterodactyl æ›´æ–°ä¿¡è™Ÿç™¼é€å®Œæˆ"
            else
              echo "âš ï¸ Pterodactyl webhook URL æœªè¨­ç½®"
            fi
            ;;

          "railway")
            # Railway Deployment Webhook
            if [[ -n "${{ secrets.RAILWAY_WEBHOOK_URL }}" ]]; then
              curl -X POST "${{ secrets.RAILWAY_WEBHOOK_URL }}" \
                -H "Content-Type: application/json" \
                -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
                -d '{
                  "service": "potato-discord-bot",
                  "environment": "production",
                  "branch": "'$BRANCH'",
                  "version": "'$VERSION'"
                }' || echo "âš ï¸ Railway webhook èª¿ç”¨å¤±æ•—"
              echo "âœ… Railway æ›´æ–°ä¿¡è™Ÿç™¼é€å®Œæˆ"
            else
              echo "âš ï¸ Railway webhook URL æœªè¨­ç½®"
            fi
            ;;

          "render")
            # Render Deploy Hook
            if [[ -n "${{ secrets.RENDER_DEPLOY_HOOK_URL }}" ]]; then
              curl -X POST "${{ secrets.RENDER_DEPLOY_HOOK_URL }}" \
                -H "Content-Type: application/json" \
                -d '{
                  "branch": "'$BRANCH'",
                  "version": "'$VERSION'",
                  "commit": "'$COMMIT'"
                }' || echo "âš ï¸ Render deploy hook èª¿ç”¨å¤±æ•—"
              echo "âœ… Render æ›´æ–°ä¿¡è™Ÿç™¼é€å®Œæˆ"
            else
              echo "âš ï¸ Render deploy hook URL æœªè¨­ç½®"
            fi
            ;;

          "heroku")
            # Heroku Release (å¦‚æœä½¿ç”¨ Heroku)
            if [[ -n "${{ secrets.HEROKU_API_KEY }}" ]]; then
              # é€™è£¡å¯ä»¥ä½¿ç”¨ Heroku API è§¸ç™¼éƒ¨ç½²
              echo "ğŸ”„ è§¸ç™¼ Heroku éƒ¨ç½²..."
              # heroku releases:create --app your-app-name
            else
              echo "âš ï¸ Heroku API key æœªè¨­ç½®"
            fi
            ;;
        esac

        # é€šç”¨ Webhook é€šçŸ¥ (å¦‚æœè¨­ç½®äº†)
        if [[ -n "${{ secrets.GENERIC_WEBHOOK_URL }}" ]]; then
          curl -X POST "${{ secrets.GENERIC_WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            -d '{
              "event": "deployment_ready",
              "provider": "${{ matrix.hosting_provider }}",
              "repository": "${{ github.repository }}",
              "branch": "'$BRANCH'",
              "version": "'$VERSION'",
              "commit": "'$COMMIT'",
              "timestamp": "'$(date -u '+%Y-%m-%d %H:%M:%S UTC')'"
            }' || echo "âš ï¸ é€šç”¨ webhook èª¿ç”¨å¤±æ•—"
        fi

  # ================================
  # éšæ®µ 4: Discord/Slack é€šçŸ¥
  # ================================
  deployment-notification:
    name: ğŸ“¢ éƒ¨ç½²é€šçŸ¥
    needs: [pre-deployment-check, deploy-to-ptero, notify-hosting-providers]
    if: always() && needs.deploy-to-ptero.result == 'success'
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¢ Discord Webhook é€šçŸ¥
      if: ${{ secrets.DISCORD_WEBHOOK_URL != '' }}
      run: |
        VERSION="${{ needs.pre-deployment-check.outputs.version_tag }}"
        COMMIT="${{ needs.pre-deployment-check.outputs.commit_hash }}"

        # ç²å–éƒ¨ç½²ç‹€æ…‹
        PTERO_STATUS="âœ… æˆåŠŸ"
        if [[ "${{ needs.deploy-to-ptero.result }}" != "success" ]]; then
          PTERO_STATUS="âŒ å¤±æ•—"
        fi

        NOTIFY_STATUS="âœ… å·²é€šçŸ¥"
        if [[ "${{ needs.notify-hosting-providers.result }}" != "success" ]]; then
          NOTIFY_STATUS="âš ï¸ éƒ¨åˆ†å¤±æ•—"
        fi

        curl -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
          -H "Content-Type: application/json" \
          -d '{
            "embeds": [{
              "title": "ğŸš€ Potato Bot éƒ¨ç½²å®Œæˆ",
              "color": 65280,
              "fields": [
                {
                  "name": "ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯",
                  "value": "**ç‰ˆæœ¬:** `'$VERSION'`\n**æäº¤:** `'$COMMIT'`\n**ç’°å¢ƒ:** `${{ inputs.deployment_environment || 'production' }}`",
                  "inline": true
                },
                {
                  "name": "ğŸ“Š éƒ¨ç½²ç‹€æ…‹",
                  "value": "**Ptero åˆ†æ”¯:** '$PTERO_STATUS'\n**è¨—ç®¡å•†é€šçŸ¥:** '$NOTIFY_STATUS'\n**ç¸½é«”ç‹€æ…‹:** âœ… æˆåŠŸ",
                  "inline": true
                },
                {
                  "name": "ğŸ”— ç›¸é—œé€£çµ",
                  "value": "[æŸ¥çœ‹æäº¤](${{ github.server_url }}/${{ github.repository }}/commit/${{ needs.pre-deployment-check.outputs.commit_hash }})\n[éƒ¨ç½²æ—¥èªŒ](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})",
                  "inline": false
                }
              ],
              "footer": {
                "text": "GitHub Actions â€¢ Potato Bot CI/CD"
              },
              "timestamp": "'$(date -u '+%Y-%m-%dT%H:%M:%S.000Z')'"
            }]
          }'

    - name: ğŸ“± Slack é€šçŸ¥ (å¯é¸)
      if: ${{ secrets.SLACK_WEBHOOK_URL != '' }}
      run: |
        curl -X POST "${{ secrets.SLACK_WEBHOOK_URL }}" \
          -H "Content-Type: application/json" \
          -d '{
            "text": "ğŸš€ Potato Bot éƒ¨ç½²å®Œæˆ",
            "attachments": [
              {
                "color": "good",
                "fields": [
                  {
                    "title": "ç‰ˆæœ¬",
                    "value": "${{ needs.pre-deployment-check.outputs.version_tag }}",
                    "short": true
                  },
                  {
                    "title": "æäº¤",
                    "value": "${{ needs.pre-deployment-check.outputs.commit_hash }}",
                    "short": true
                  },
                  {
                    "title": "ç’°å¢ƒ",
                    "value": "${{ inputs.deployment_environment || 'production' }}",
                    "short": true
                  },
                  {
                    "title": "ç‹€æ…‹",
                    "value": "éƒ¨ç½²æˆåŠŸï¼Œè¨—ç®¡å•†å·²é€šçŸ¥æ›´æ–°",
                    "short": false
                  }
                ]
              }
            ]
          }'

  # ================================
  # éšæ®µ 5: å¤±æ•—è™•ç†
  # ================================
  deployment-failure-handling:
    name: ğŸš¨ éƒ¨ç½²å¤±æ•—è™•ç†
    needs: [pre-deployment-check, deploy-to-ptero, notify-hosting-providers]
    if: always() && (failure() || needs.pre-deployment-check.outputs.deploy_ready == 'false')
    runs-on: ubuntu-latest

    steps:
    - name: ğŸš¨ å‰µå»ºéƒ¨ç½²å¤±æ•— Issue
      uses: actions/github-script@v7
      with:
        script: |
          const readinessCheck = '${{ needs.pre-deployment-check.result }}';
          const pteroDeployment = '${{ needs.deploy-to-ptero.result }}';
          const hostingNotification = '${{ needs.notify-hosting-providers.result }}';

          let failureReasons = [];
          let severity = 'medium';

          if (readinessCheck === 'failure') {
            failureReasons.push('âœ— éƒ¨ç½²æº–å‚™æª¢æŸ¥å¤±æ•—');
            severity = 'high';
          }

          if (pteroDeployment === 'failure') {
            failureReasons.push('âœ— Ptero åˆ†æ”¯éƒ¨ç½²å¤±æ•—');
            severity = 'high';
          }

          if (hostingNotification === 'failure') {
            failureReasons.push('âœ— è¨—ç®¡å•†é€šçŸ¥å¤±æ•—');
          }

          const severityEmoji = {
            'low': 'ğŸŸ¨',
            'medium': 'ğŸŸ§',
            'high': 'ğŸŸ¥',
            'critical': 'ğŸš¨'
          };

          await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: severityEmoji[severity] + " è‡ªå‹•éƒ¨ç½²å¤±æ•— - " + severity.toUpperCase() + " å„ªå…ˆç´š",
            body: "## ğŸš¨ è‡ªå‹•éƒ¨ç½²å¤±æ•—å ±å‘Š

          ### ğŸ“‹ åŸºæœ¬ä¿¡æ¯
          - **å¤±æ•—æ™‚é–“:** " + new Date().toISOString() + "
          - **åš´é‡ç¨‹åº¦:** `" + severity.toUpperCase() + "`
          - **è§¸ç™¼æäº¤:** [" + context.sha.substring(0, 7) + "](" + context.payload.repository.html_url + "/commit/" + context.sha + ")
          - **å·¥ä½œæµç¨‹:** [æŸ¥çœ‹è©³æƒ…](" + context.payload.repository.html_url + "/actions/runs/" + context.runId + ")

          ### âŒ å¤±æ•—åŸå› 
          " + (failureReasons.length > 0 ? failureReasons.map(reason => "- " + reason).join('\n') : "- æœªçŸ¥åŸå› ï¼Œè«‹æª¢æŸ¥å·¥ä½œæµç¨‹æ—¥èªŒ") + "

          ### ğŸ” éšæ®µçµæœ
          - **éƒ¨ç½²æº–å‚™:** `" + (readinessCheck || 'skipped') + "`
          - **Ptero éƒ¨ç½²:** `" + (pteroDeployment || 'skipped') + "`
          - **è¨—ç®¡å•†é€šçŸ¥:** `" + (hostingNotification || 'skipped') + "`

          ### ğŸ› ï¸ æ‰‹å‹•ä¿®å¾©æ­¥é©Ÿ

          #### 1. æª¢æŸ¥ Ptero åˆ†æ”¯
          \`\`\`bash
          git checkout ptero
          git pull origin ptero
          # æª¢æŸ¥åˆ†æ”¯ç‹€æ…‹å’Œæ–‡ä»¶å®Œæ•´æ€§
          \`\`\`

          #### 2. æ‰‹å‹•éƒ¨ç½²åˆ°è¨—ç®¡å•†
          - æª¢æŸ¥ Pterodactyl Panel æ˜¯å¦éœ€è¦æ‰‹å‹•é‡å•Ÿ
          - ç¢ºèª Railway/Render éƒ¨ç½²ç‹€æ…‹
          - é©—è­‰ç’°å¢ƒè®Šé‡å’Œé…ç½®

          #### 3. é©—è­‰éƒ¨ç½²ç‹€æ…‹
          \`\`\`bash
          # æª¢æŸ¥ Bot æ˜¯å¦æ­£å¸¸å•Ÿå‹•
          # é©—è­‰æ‰€æœ‰ Cogs è¼‰å…¥
          # æ¸¬è©¦æ ¸å¿ƒåŠŸèƒ½
          \`\`\`

          ### ğŸ“‹ ä¿®å¾©æª¢æŸ¥æ¸…å–®
          - [ ] æª¢æŸ¥ä¸¦ä¿®å¾©éƒ¨ç½²é…ç½®å•é¡Œ
          - [ ] æ‰‹å‹•æ›´æ–° Ptero åˆ†æ”¯ (å¦‚éœ€è¦)
          - [ ] é€šçŸ¥è¨—ç®¡å•†æ‰‹å‹•éƒ¨ç½²
          - [ ] é©—è­‰ Bot åœ¨ç”Ÿç”¢ç’°å¢ƒæ­£å¸¸é‹è¡Œ
          - [ ] æª¢æŸ¥æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
          - [ ] ä¿®å¾©å®Œæˆå¾Œé—œé–‰æ­¤ Issue

          ### ğŸš¨ ç·Šæ€¥è¯çµ¡
          å¦‚æœé€™å½±éŸ¿åˆ°ç”Ÿç”¢æœå‹™ï¼š
          1. ç«‹å³æª¢æŸ¥ Bot åœ¨è¨—ç®¡ç’°å¢ƒçš„ç‹€æ…‹
          2. å¦‚æœ‰å¿…è¦ï¼Œå›æ»¾åˆ°ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
          3. é€šçŸ¥ç›¸é—œåœ˜éšŠæˆå“¡

          /label " + severity + "-priority,deployment-failed,needs-review",
            labels: [severity + "-priority", "deployment-failed", "needs-review"]
          });

    - name: ğŸš¨ ç·Šæ€¥é€šçŸ¥
      if: ${{ secrets.DISCORD_WEBHOOK_URL != '' }}
      run: |
        curl -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
          -H "Content-Type: application/json" \
          -d '{
            "embeds": [{
              "title": "ğŸš¨ Potato Bot éƒ¨ç½²å¤±æ•—",
              "color": 16711680,
              "fields": [
                {
                  "name": "âŒ å¤±æ•—éšæ®µ",
                  "value": "æº–å‚™æª¢æŸ¥: `${{ needs.pre-deployment-check.result || 'skipped' }}`\nPtero éƒ¨ç½²: `${{ needs.deploy-to-ptero.result || 'skipped' }}`\nè¨—ç®¡å•†é€šçŸ¥: `${{ needs.notify-hosting-providers.result || 'skipped' }}`",
                  "inline": false
                },
                {
                  "name": "ğŸ”— è™•ç†é€£çµ",
                  "value": "[æŸ¥çœ‹å·¥ä½œæµç¨‹](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})\n[æª¢æŸ¥ Issues](${{ github.server_url }}/${{ github.repository }}/issues)",
                  "inline": false
                }
              ],
              "footer": {
                "text": "éœ€è¦ç«‹å³è™•ç† â€¢ GitHub Actions"
              },
              "timestamp": "'$(date -u '+%Y-%m-%dT%H:%M:%S.000Z')'"
            }]
          }'
